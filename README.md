# Minecraft Server Event Monitor

A React web application that monitors Minecraft server events in real-time via MQTT or direct HTTP.

This project is designed to work with events generated by [minecraft-webhook](https://github.com/edward3h/minecraft-webhook), which monitors Minecraft server logs and publishes events.

## Features

- Real-time event monitoring via MQTT
- Player connection/disconnection tracking
- Session duration tracking (total and last session) with seconds precision
- Live current session duration for online players
- Server status monitoring
- Backup completion notifications
- Persistent player data storage on server
- Current players display (only when online)
- Comprehensive player statistics table
- Configurable background wallpapers
- Connection status indicators (Backend & MQTT)
- Docker deployment support

## Configuration

Edit `src/config.json`:

```json
{
  "eventSource": "mqtt",
  "debugLevel": "info",
  "mqtt": {
    "broker": "ws://your-mqtt-broker:9001",
    "topic": "mc-webhook",
    "clientId": "mclog-viewer",
    "username": "your-username",
    "password": "your-password"
  },
  "ui": {
    "background": "url('wallpapers/wallpaper_minecraft_bedrock_edition_1920x1080.png')"
  }
}
```

### Event Sources
- `"mqtt"` - Receive events from MQTT broker
- `"direct"` - Receive events via HTTP POST to `/api/events`

### Debug Levels
- `"error"` - Only error messages
- `"info"` - Info and error messages (default)
- `"debug"` - All messages including player updates

## Event Types

The application expects JSON events with these types:
- `PLAYER_CONNECTED`
- `PLAYER_DISCONNECTED` 
- `SERVER_STARTED`
- `SERVER_STOPPED`
- `BACKUP_COMPLETE`

## Event Format

```json
{
  "type": "PLAYER_CONNECTED",
  "containerId": "container-id",
  "containerName": "/minecraft1",
  "worldName": "My Level",
  "playerName": "Steve",
  "playerXuid": "12345"
}
```

## Wallpapers

Place wallpaper images in the `wallpapers/` directory. Configure the background in `src/config.json`:

- **Image**: `"url('wallpapers/your-image.png')"`
- **Gradient**: `"linear-gradient(135deg, #667eea 0%, #764ba2 100%)"`
- **Solid color**: `"#2c3e50"`

## Installation

```bash
npm install
npm start
```

## Data Persistence

Player data is automatically saved to the server on every event and restored on page load via `/api/player-data` endpoint.

## API Endpoints

- `GET /api/player-data` - Load current player data (recomputed on each call)
- `GET /api/config` - Get UI configuration
- `POST /api/events` - Receive events directly (when eventSource is "direct")

### Direct Event Example

```bash
curl -X POST http://localhost:3001/api/events \
  -H "Content-Type: application/json" \
  -d '{
    "type": "PLAYER_CONNECTED",
    "playerName": "Steve",
    "worldName": "My Level",
    "containerName": "/minecraft1",
    "playerXuid": "12345"
  }'
```

## Development

```bash
# Terminal 1 - React dev server
npm start

# Terminal 2 - API server  
npm run server
```

## Production

```bash
npm run prod
```

## Docker Deployment

```bash
# Build and run
docker-compose up -d

# Stop
docker-compose down
```

### Docker Compose Example

```yaml
version: '3.8'

services:
  mcwebsite:
    build: .
    ports:
      - "3001:3001"
    volumes:
      - ./src/config.json:/app/src/config.json
      - ./wallpapers:/app/wallpapers
      - player-data:/app/data
    environment:
      - NODE_ENV=production
    restart: unless-stopped

volumes:
  player-data:
```

### Docker Features
- Volume mounts for config and wallpapers
- Persistent data storage
- Auto-restart on failure
- Production optimized build